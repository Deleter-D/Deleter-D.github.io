---
title: 毕昇编译器版本升级注意事项
toc: true
mathjax: true
tags:
  - 毕昇编译器
categories: [高性能计算,项目]
abbrlink: 29203
date: 2023-05-30 18:32:24
---

毕昇编译器版本升级之后，有一些需要注意和改动的地方。

<!-- more -->

# 编译器版本升级注意事项

## 版本信息

### 升级前

```
BiShengCPP-B030 Only For PengCheng clang version 14.0.0 (2b53695e1bb8)
Target: aarch64-unknown-linux-gnu
Thread model: posix
InstalledDir: /home/bisheng_tester2/Ascend/ascend-toolkit/latest/aarch64-linux/bisheng_cpp/bin
```

### 升级后

```
BiShengCPP B107 Only For PengCheng clang version 15.0.5 (clang-3fb32fbe51cb flang-3fb32fbe51cb)
Target: aarch64-unknown-linux-gnu
Thread model: posix
InstalledDir: /home/bisheng_tester2/Ascend/ascend-toolkit/latest/aarch64-linux/bisheng_cpp/bin
```

## 代码改动

### 配置文件改动

顶层`CMakeLists.txt`中的`-lsycl`不再需要。即231行改回原版的状态，如下。

```cmake
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${ITK_REQUIRED_CXX_FLAGS}")
```

包含算子的`CMakeLists.txt`中的编译参数有变化。由原来的：

```cmake
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsycl -fsycl-targets=ascend_910-cce")
```

改为：

```cmake
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsycl -fdevices=ascend_910")
```

### 接口改动

获取group的id时，接口从`group.get_id()`变为`group.get_group_id()`。

目前只知道这一个接口变动，后续如果发现有重要的变动会在此更新。

### 类型支持问题

如果在编译过程中并未出现错误，那么类型支持问题可以忽略不看。

升级后的编译器由暂不支持`long double`数据类型，故需要将涉及到的`long double`类型的**全局变量**注释掉。

___

所有改动可以参考[本次commit](https://gitee.com/yichu12138/itk/commit/f21ba71ab931d977395d66644a0e90a49cb3f5e1)的内容。
